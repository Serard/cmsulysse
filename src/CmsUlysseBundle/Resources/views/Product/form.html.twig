{% extends "::base.html.twig" %}

{% block title %}CmsUlysseBundle:Product:add{% endblock %}

{% block body %}

<h1 xmlns="http://www.w3.org/1999/html">Welcome to the Product:add page</h1>
    <form action="{{ path('product_add') }}" method="POST" {{ form_enctype(form) }} class="form">
        <section>
            {{ form_row(form.name) }}
        </section>
        <section>
            {{ form_row(form.description) }}
        </section>
        <section>
            {{ form_row(form.file) }}
        </section>
        <section>
            {{ form_row(form.categories) }}
        </section>
        <section>
            <ul class="specifications" data-prototype="{{ form_widget(form.specifications.vars.prototype)|e }}">
                {# it√®re sur chaque spec existantes #}
                {% for specification in form.specifications %}
                    <li>{{ form_row(specification.name) }}</li>
                    <li>{{ form_row(specification.content) }}</li>
                {% endfor %}
            </ul>
        </section>
        <section>
            {{ form_widget(form.user_products.vars.prototype) }}
        </section>
        <section style="display:none" class="spec">
            {{ form_row(form.specifications) }}
            {{ form_row(form.user_products) }}
        </section>
        {{ form_rest(form) }}
    </form>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <script>
        var collectionHolder = $('ul.specifications');
        var $addSpecLink = $('<a href="#">Ajouter une specification</a>');

        var $newLinkLi = $('<li></li>').append($addSpecLink);
        jQuery(document).ready(function() {
            collectionHolder.append($newLinkLi);
            $addSpecLink.on('click', function(e) {
                e.preventDefault();
                addSpecForm(collectionHolder, $newLinkLi);
            });
        });
        function addSpecForm(collectionHolder, $newLinkLi) {
            var prototype = collectionHolder.attr('data-prototype');
            var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);
            var $newFormLi = $('<li></li>').append(newForm);
            $newLinkLi.before($newFormLi);
        }
    </script>

{% endblock %}
