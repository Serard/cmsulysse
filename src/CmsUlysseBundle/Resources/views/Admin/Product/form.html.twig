{% extends ":Admin:base.html.twig" %}

{% block body_content %}
    <a href="#"><strong> Ajout d'un Produit</strong></a>
    <hr>
    <div class="row col-lg-8">
        <form class="form-horizontal" action="{{ path('product_add_admin') }}" method="POST" {{ form_enctype(form) }} class="form-horizontal">
            <section class="form-group">
                <h4 style="color: #002a80">Produit</h4>
                {{ form_label(form.name, "Nom", {'label_attr': {'class': 'col-sm-2 control-label'}} ) }}
                <div class="col-sm-10">
                    {{ form_widget(form.name, {'attr': {'class': 'form-control'}} ) }}
                </div>
                {{ form_errors(form.name) }}
            </section>
            <section class="form-group">
                {{ form_label(form.description, "Description", {'label_attr': {'class': 'col-sm-2 control-label'}} ) }}
                <div class="col-sm-10">
                    {{ form_widget(form.description, {'attr': {'class': 'form-control'}} ) }}
                </div>
                {{ form_errors(form.description) }}
            </section>
            <section class="form-group">
                {{ form_label(form.categories, "Categories", {'label_attr': {'class': 'col-sm-2 control-label'}} ) }}
                <div class="col-sm-10">
                    {{ form_widget(form.categories, {'attr': {'class': 'form-control'}} ) }}
                </div>
                {{ form_errors(form.categories) }}
            </section>
            <section class="form-group">
                <ul style="list-style:none;" class="pictures" data-prototype="{{ form_widget(form.pictures.vars.prototype)|e }}">
                    {% for picture in form.pictures %}
                        <li>{{ form_row(picture.file) }}</li>
                    {% endfor %}
                </ul>
            </section>
            <hr>
            <section class="form-group">
                <h4 style="color: #002a80">Spécifications</h4>
                <ul style="list-style:none;" class="specifications" data-prototype="{{ form_widget(form.specifications.vars.prototype)|e }}">
                    {# itère sur chaque spec existantes #}
                    {% set delete = 1 %}
                    {% for specification in form.specifications %}
                        <ul id="{{ delete }}">
                            <li>{{ form_row(specification.name) }}</li>
                            <li>{{ form_row(specification.content) }}</li>
                            <div onclick='deleteSpecForm({{ delete }});' >Supprimer</div>
                        </ul>
                        {% set delete = delete + 1 %}
                    {% endfor %}
                </ul>
            </section>
            <section class="form-group">
                {{ form_label(form.valid, "Valider", {'label_attr': {'class': 'col-sm-2 control-label'}} ) }}
                <div class="col-sm-10">
                    {{ form_widget(form.valid) }}
                </div>
                {{ form_errors(form.valid) }}
            </section>
            <div style="display: none">
                {{ form_row(form.pictures) }}
                {{ form_row(form.specifications) }}
            </div>
            {{ form_rest(form) }}
        </form>
    </div>


<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

<script>
    var collectionHolder = $('ul.specifications');
    var $addSpecLink = $('<a href="#">Ajouter une specification</a>');
    var idadd = {{ delete }};

    var $newLinkLi = $('<li></li>').append($addSpecLink);
    jQuery(document).ready(function() {
        collectionHolder.append($newLinkLi);
        $addSpecLink.on('click', function(e) {
            e.preventDefault();
            addSpecForm(collectionHolder, $newLinkLi);
        });
    });
    function addSpecForm(collectionHolder, $newLinkLi) {
        var prototype = collectionHolder.attr('data-prototype');
        var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);
        var $newFormLi = $("<li id='"+idadd+"'></li>").append(newForm);
        $newLinkLi.before($newFormLi);
        var $button = $($newFormLi).append("<div onclick='deleteSpecForm("+idadd+");'>Supprimer</div>");
        idadd++;
    }

    function deleteSpecForm(id) {
        document.getElementById(id).remove();
    }

</script>
<script>
    var collectionHolderPicture = $('ul.pictures');
    var $addPictLink = $('<a href="#">Ajouter une photo</a>');

    var $newLink = $('<li></li>').append($addPictLink);
    jQuery(document).ready(function() {
        collectionHolderPicture.append($newLink);
        $addPictLink.on('click', function(e) {
            e.preventDefault();
            addSpecForm(collectionHolderPicture, $newLink);
        });
    });
    function addSpecForm(collectionHolderPicture, $newLink) {
        var proto = collectionHolderPicture.attr('data-prototype');
        var newFormFile = proto.replace(/__name__/g, collectionHolderPicture.children().length);
        var $newFormLi = $('<li></li>').append(newFormFile);
        $newLink.before($newFormLi);
    }
</script>

{% endblock %}