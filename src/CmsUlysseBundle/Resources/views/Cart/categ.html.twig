{% extends "::base.html.twig" %}

{% block title %}Market{% endblock %}

{% block body %}
    <input type="search" placeholder="search" id="search" name="search"/>
    <select>
        <option id="TOUS" name="0">TOUS</option>
        {% for category in categories %}
            {% if (app.session.get('category') == category.id) %}
                <option id="{{ category.name }}" name="{{ category.id }}" class="optgroup" selected>{{ category.name }}</option>
            {% else %}
                <option id="{{ category.name }}" name="{{ category.id }}" class="optgroup">{{ category.name }}</option>
            {% endif %}
            {{ category.name }}
            {% for categ_down in categs_down %}
                {% if  categ_down.categup.id == category.id %}
                    {% if (app.session.get('category') == categ_down.id)%}
                        <option id="{{ categ_down.name }}" name="{{ categ_down.id }}" selected>{{ categ_down.name }}</option>
                    {% else %}
                        <option id="{{ categ_down.name }}" name="{{ categ_down.id }}">{{ categ_down.name }}</option>
                    {% endif %}
                {% endif %}
            {% endfor %}
        {% endfor %}
    </select>
    <div id="results">
        <h1>Liste des produits {{ category }}</h1>
        <table>
            <tr>
                <th>Nom</th>
                <th>Description</th>
                <th>Prix</th>
                <th>Quantité</th>
                <th>Vendeur</th>
                <th>Action</th>
            </tr>
            {% for userproduct in products %}
                <tr>
                    <td id="name{{ userproduct.id }}">{{ userproduct.product.name }}</td>
                    <td id="description{{ userproduct.id }}">{{ userproduct.product.description }}</td>
                    <td id="price{{ userproduct.id }}">{{ userproduct.price }}</td>
                    <td id="stock{{ userproduct.id }}">{{ userproduct.qty }}</td>
                    <td id="seller{{ userproduct.id }}">{{ userproduct.user.lastname }} {{ userproduct.user.firstname }}</td>
                    <td>{% if userproduct.qty != 0 %}
                            <button onclick="addCart({{ userproduct.id }});">Ajouter</button>
                        {% else %}
                            Produit épuisé
                        {% endif %}
                    </td>
                    <td id="errorqty{{ userproduct.id }}" style="display:none;">Vous avez atteind la quantité maximum de ce produit</td>
                </tr>
            {% endfor %}
        </table>
        <a href="{{ path('user_cart') }}"> Mon panier</a>
    </div>
{% endblock %}